<?xml version="1.0" encoding="utf-8"?>
<project name="App2" default="build">
    <property name="basedir" value="." override="true" />

    <target name="build" depends="phpcs, phpmd, phpcpd, phpunit" />

    <target name="phpcs" description="PHPCS">
        <phpcodesniffer standard="Zend" file="${basedir}/" allowedFileExtensions="php">
            <formatter type="checkstyle" outfile="${basedir}/tmp/tests/phpcs.xml" />
        </phpcodesniffer>
    </target>

    <target name="phpmd">
        <phpmd rulesets="${basedir}/../ruleset.xml">
            <fileset dir="./">
                <include name="${basedir}/**/*.php" />
                <exclude name="${basedir}/Vendor/" />
            </fileset>
            <formatter type="xml" outfile="${basedir}/tmp/tests/phpmd.xml" />
        </phpmd>
    </target>

    <target name="phpcpd" description="PHPCPD">
        <phpcpd minTokens="10">
            <fileset dir="${basedir}">
                <include name="**/**/*.php"/>
            </fileset>
            <formatter type="pmd"
                outfile="${basedir}/tmp/tests/cpd.xml"/>
        </phpcpd>
    </target>
    <!--
    <target name="phpunit" >
        <exec executable="${basedir}/Console/cake" >
            <arg line="test app AllTests" />
        </exec>
        <exec executable="${basedir}/Console/cake" logoutput="true">
            <arg line="test app AllTests" />
        </exec>
    </target>
    -->

    <target name="phpunit" description="Run CakePHP unit tests with PHPUnit">
        <exec dir="${basedir}" executable="./Console/cake" output="${basedir}/tmp/tests/caketest.log">
            <arg line="test" />
            <arg line="--log-junit=${basedir}/tmp/tests/phpunit.xml" />
            <arg line="--coverage-html=${basedir}/tmp/tests/build/coverage/" />
            <arg line="--coverage-clover=${basedir}/tmp/tests/coverage.xml" />
            <arg line="app" />
            <arg line="AllTests" />
        </exec>
    </target>

</project>
